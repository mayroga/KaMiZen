<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>KaMiZen - NeuroFinancial Game</title>
<style>
body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background:#0f172a;
    color:white;
}
header{
    background:#111827;
    padding:15px;
    text-align:center;
    font-size:22px;
    font-weight:bold;
    color:#00ffcc;
}
.container{
    display:flex;
    flex-wrap:wrap;
}
.left, .right{
    padding:20px;
    box-sizing:border-box;
}
.left{
    flex:2;
    min-width:300px;
}
.right{
    flex:1;
    background:#1e293b;
    min-width:280px;
}
.box{
    background:#1e293b;
    padding:15px;
    margin-bottom:15px;
    border-radius:8px;
}
button{
    padding:8px 12px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-weight:bold;
}
.primary{
    background:#00ffcc;
    color:black;
}
.chat-box{
    height:250px;
    overflow-y:auto;
    background:#0f172a;
    padding:10px;
    border-radius:6px;
    font-size:14px;
}
input{
    padding:8px;
    width:70%;
    border-radius:5px;
    border:none;
}
.status{
    display:flex;
    justify-content:space-between;
    font-size:14px;
    margin-bottom:10px;
}
.rank-item{
    font-size:14px;
    margin-bottom:5px;
}
.question{
    font-size:18px;
    margin-bottom:10px;
    min-height:50px;
}
.feedback{
    margin-top:10px;
    font-weight:bold;
    color:#00ffcc;
}
.timer{
    font-size:16px;
    color:#ffcc00;
}
.progress-container{
    width:100%;
    background:#333;
    height:12px;
    border-radius:6px;
    margin-top:10px;
}
.progress-fill{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#00ffcc,#ffcc00);
    border-radius:6px;
    transition:width 0.3s ease;
}
.mini-story{
    font-size:14px;
    margin-top:10px;
    color:#f9ed69;
    min-height:20px;
}
.simulated{
    opacity:0.7;
    font-style:italic;
}
</style>
</head>
<body>

<header>üî• KaMiZen ‚Äì 10 Min NeuroFinancial Game</header>

<div class="container">

<div class="left">
<div class="box">
<div class="status">
<div>üî• Conectados: <span id="participants">0</span>/500</div>
<div class="timer">‚è≥ <span id="time">10:00</span></div>
</div>
<div class="progress-container">
<div class="progress-fill" id="progressFill"></div>
</div>
</div>

<div class="box">
<div class="question" id="question">Cargando desaf√≠o...</div>
<input type="text" id="answerInput" placeholder="Escribe tu respuesta aqu√≠...">
<button class="primary" onclick="sendAnswer()">Enviar</button>
<button onclick="showAnswer()">Ver respuesta</button>
<div class="feedback" id="feedback"></div>
<div class="mini-story" id="miniStory"></div>
<audio id="audioClip"></audio>
</div>

<div class="box">
<h3>üèÜ Top 5 Traders</h3>
<div id="ranking"></div>
</div>
</div>

<div class="right">
<div class="box">
<h3>üí¨ Chat de Bots</h3>
<div class="chat-box" id="chatBox"></div>
</div>
</div>

</div>

<script>
// -----------------------------
// CONFIGURACI√ìN
// -----------------------------
let sessionTime = 600; // 10 min
let elapsedTime = 0;
let userLevel = 1;
let ranking = [];
let askedQuestions = new Set();
const participants = 1;
const questionMinInterval = 8;
const questionMaxInterval = 12;

// -----------------------------
// ELEMENTOS
// -----------------------------
const questionEl = document.getElementById("question");
const feedbackEl = document.getElementById("feedback");
const answerInput = document.getElementById("answerInput");
const timeEl = document.getElementById("time");
const rankingEl = document.getElementById("ranking");
const progressFill = document.getElementById("progressFill");
const chatBox = document.getElementById("chatBox");
const miniStoryEl = document.getElementById("miniStory");
const audioClip = document.getElementById("audioClip");

// -----------------------------
// RETOS
// -----------------------------
function generateGame(){
    const games = [
        () => {
            let a=Math.floor(Math.random()*5+1), b=Math.floor(Math.random()*7+3);
            return {q:`Si hoy me siento ${a} puntos feliz y ma√±ana ${b} m√°s‚Ä¶ ¬øcu√°nto tendr√©?`,a:`${a+b}`};
        },
        () => {
            let n=Math.floor(Math.random()*36+5);
            return {q:`¬øCu√°nto es el doble de ${n}?`,a:`${n*2}`};
        },
        () => {
            let s=Math.floor(Math.random()*5+1);
            return {q:`${s}, ${s*2}, ${s*3}, ___`,a:`${s*4}`};
        },
        () => {
            return {q:`N√∫mero par >10 y <20. Si me divides entre 2 da 7. ¬øQui√©n soy?`,a:"14"};
        },
        () => {
            let t=Math.floor(Math.random()*80+20), m=Math.floor(Math.random()*11+5);
            return {q:`Si tengo ${t} y pierdo ${m}, ¬øcu√°nto queda?`,a:`${t-m}`};
        },
        () => {
            return {q:"Cruzo fronteras sin pasaporte y guardo tesoros. ¬øQu√© soy?",a:"conocimiento de embarque"};
        }
    ];
    let game;
    do {
        game = games[Math.floor(Math.random()*games.length)]();
    } while(askedQuestions.has(game.q));
    askedQuestions.add(game.q);
    return game;
}

// -----------------------------
// BARRA DE PROGRESO
// -----------------------------
function updateProgress(){
    let pct = (elapsedTime/sessionTime)*100;
    progressFill.style.width = pct+"%";
}

// -----------------------------
// RANKING SIMULADO
// -----------------------------
function updateRanking(){
    ranking = [
        {name:"TraderA",level:userLevel+Math.floor(Math.random()*2)},
        {name:"TraderB",level:userLevel+Math.floor(Math.random()*2)},
        {name:"TraderC",level:userLevel+Math.floor(Math.random()*2)},
        {name:"TraderD",level:userLevel+Math.floor(Math.random()*2)},
        {name:"T√∫",level:userLevel}
    ];
    rankingEl.innerHTML = "";
    ranking.forEach(r=>{
        let div = document.createElement("div");
        div.className="rank-item";
        div.innerText = `${r.name} - Nivel ${r.level}`;
        rankingEl.appendChild(div);
    });
}

// -----------------------------
// MINI HISTORIAS Y AUDIO
// -----------------------------
const miniStories = [
    "üí° Ana duplic√≥ su productividad con esta decisi√≥n.",
    "üî• Carlos avanz√≥ 2 niveles resolviendo r√°pido.",
    "üèÜ Pedro aplic√≥ la estrategia y subi√≥ de nivel.",
    "‚ö° Luisa resolvi√≥ el reto y siente dopamina."
];
const audioClips = [
    "/static/audio/male1.mp3",
    "/static/audio/male2.mp3"
];

function playAudio(){
    let clip = audioClips[Math.floor(Math.random()*audioClips.length)];
    audioClip.src = clip;
    audioClip.play();
}

// -----------------------------
// NUEVO RETO
// -----------------------------
let currentGame;
function newChallenge(){
    currentGame = generateGame();
    questionEl.innerText = currentGame.q;
    feedbackEl.innerText = "";
    miniStoryEl.innerText = miniStories[Math.floor(Math.random()*miniStories.length)];
    playAudio();
}

// -----------------------------
// RESPONDER
// -----------------------------
function sendAnswer(){
    let ans = answerInput.value.trim();
    if(ans==="") return;
    if(ans.toLowerCase()===currentGame.a.toLowerCase()){
        userLevel++;
        feedbackEl.innerText = "üí• Correcto! Dopamina activada!";
    } else {
        feedbackEl.innerText = `‚ùå Incorrecto. Era: ${currentGame.a}`;
    }
    answerInput.value="";
    updateRanking();
    newChallenge();
}

// -----------------------------
// SHOW ANSWER
// -----------------------------
function showAnswer(){
    feedbackEl.innerText = "Responde para activar dopamina üí•";
}

// -----------------------------
// BOTS SIMULADOS
// -----------------------------
const botMsgs = ["üî• Otro trader sube nivel","üí∞ Cada decisi√≥n suma","‚ö° R√°pido!","üèÜ Nivel aumentado"];
function botChat(){
    let msg = botMsgs[Math.floor(Math.random()*botMsgs.length)];
    let div = document.createElement("div");
    div.className="simulated";
    div.innerText = `BOT: ${msg}`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

// -----------------------------
// TEMPORIZADOR PRINCIPAL
// -----------------------------
function formatTime(s){return `${Math.floor(s/60)}:${(s%60<10?"0":"")}${s%60}`;}
let sessionInterval = setInterval(()=>{
    if(elapsedTime>=sessionTime){
        clearInterval(sessionInterval);
        questionEl.innerText="‚è≥ Sesi√≥n finalizada. ¬°Ma√±ana subes de nivel!";
        feedbackEl.innerText="";
        return;
    }
    elapsedTime++;
    timeEl.innerText = formatTime(sessionTime-elapsedTime);
    updateProgress();
},1000);

// -----------------------------
// RETOS AUTOM√ÅTICOS
// -----------------------------
function scheduleNextChallenge(){
    let delay = Math.random()*(questionMaxInterval-questionMinInterval)+questionMinInterval;
    setTimeout(()=>{
        newChallenge();
        scheduleNextChallenge();
        botChat();
    }, delay*1000);
}

// -----------------------------
// INICIO
// -----------------------------
updateRanking();
newChallenge();
scheduleNextChallenge();

</script>

</body>
</html>
