<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>KaMiZen - NeuroFinancial Game</title>

<style>
body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background:#0f172a;
    color:white;
}

header{
    background:#111827;
    padding:15px;
    text-align:center;
    font-size:22px;
    font-weight:bold;
    color:#00ffcc;
}

.container{
    display:flex;
    flex-wrap:wrap;
}

.left, .right{
    padding:20px;
    box-sizing:border-box;
}

.left{
    flex:2;
    min-width:300px;
}

.right{
    flex:1;
    background:#1e293b;
    min-width:280px;
}

.box{
    background:#1e293b;
    padding:15px;
    margin-bottom:15px;
    border-radius:8px;
}

button{
    padding:8px 12px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-weight:bold;
}

.primary{
    background:#00ffcc;
    color:black;
}

.chat-box{
    height:250px;
    overflow-y:auto;
    background:#0f172a;
    padding:10px;
    border-radius:6px;
    font-size:14px;
}

input{
    padding:8px;
    width:70%;
    border-radius:5px;
    border:none;
}

.status{
    display:flex;
    justify-content:space-between;
    font-size:14px;
    margin-bottom:10px;
}

.rank-item{
    font-size:14px;
    margin-bottom:5px;
}

.question{
    font-size:18px;
    margin-bottom:10px;
    min-height:50px;
}

.feedback{
    margin-top:10px;
    font-weight:bold;
    color:#00ffcc;
}

.timer{
    font-size:16px;
    color:#ffcc00;
}

</style>
</head>

<body>

<header>üî• KaMiZen ‚Äì 10 Min NeuroFinancial Game</header>

<div class="container">

<div class="left">

<div class="box">
<div class="status">
<div>üî• Conectados: <span id="participants">0</span>/500</div>
<div class="timer">‚è≥ <span id="time">10:00</span></div>
</div>
</div>

<div class="box">
<div class="question" id="question">Cargando desaf√≠o...</div>

<input type="text" id="answerInput" placeholder="Escribe tu respuesta aqu√≠...">
<button class="primary" onclick="sendAnswer()">Enviar</button>
<button onclick="showAnswer()">Ver respuesta</button>

<div class="feedback" id="feedback"></div>
</div>

<div class="box">
<h3>üèÜ Top 5 Traders</h3>
<div id="ranking"></div>
</div>

</div>

<div class="right">

<div class="box">
<h3>üí¨ Chat en vivo (an√≥nimo)</h3>
<div class="chat-box" id="chatBox"></div>
<br>
<input type="text" id="chatInput" placeholder="Escribe mensaje...">
<button class="primary" onclick="sendChat()">Enviar</button>
</div>

</div>

</div>

<script>

let ws = new WebSocket(`ws://${location.host}/ws`);
let currentAnswer = "";
let timeLeft = 600;

// ------------------
// TIMER 10 MINUTOS
// ------------------
setInterval(()=>{
    if(timeLeft>0){
        timeLeft--;
        let min = Math.floor(timeLeft/60);
        let sec = timeLeft%60;
        document.getElementById("time").innerText =
            `${min}:${sec<10?"0":""}${sec}`;
    }
},1000);

// ------------------
// WEBSOCKET EVENTS
// ------------------
ws.onmessage = function(event){

    let data = JSON.parse(event.data);

    if(data.type==="question"){
        document.getElementById("question").innerText = data.text;
        document.getElementById("feedback").innerText = "";
        currentAnswer = "";
    }

    if(data.type==="feedback"){
        document.getElementById("feedback").innerText = data.text;
    }

    if(data.type==="update_participants"){
        document.getElementById("participants").innerText = data.count;
    }

    if(data.type==="update_ranking"){
        let rankingDiv = document.getElementById("ranking");
        rankingDiv.innerHTML = "";
        data.ranking.forEach(r=>{
            rankingDiv.innerHTML +=
                `<div class="rank-item">${r.name} - Nivel ${r.level}</div>`;
        });
    }

    if(data.type==="chat"){
        let chatBox = document.getElementById("chatBox");
        chatBox.innerHTML +=
            `<div><strong>${data.sender}:</strong> ${data.text}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
    }

};

// ------------------
// SEND ANSWER
// ------------------
function sendAnswer(){
    let input = document.getElementById("answerInput");
    let text = input.value.trim();
    if(text==="") return;

    ws.send(JSON.stringify({
        type:"answer",
        text:text
    }));

    input.value="";
}

// ------------------
// SHOW ANSWER BUTTON
// ------------------
function showAnswer(){
    document.getElementById("feedback").innerText =
        "Responde para ver si activas dopamina üí•";
}

// ------------------
// SEND CHAT
// ------------------
function sendChat(){
    let input = document.getElementById("chatInput");
    let text = input.value.trim();
    if(text==="") return;

    ws.send(JSON.stringify({
        type:"chat",
        text:text
    }));

    input.value="";
}

</script>

</body>
</html>
