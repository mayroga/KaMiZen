<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KaMiZen by MAY ROGA LLC</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        :root {
            --primary-bg: #FAF9F6;
            --accent-color: #1A1A1A;
            --text-color: #2C3E50;
            --gold-accent: #D4AF37;
        }

        body { 
            margin: 0; 
            background: var(--primary-bg); 
            font-family: 'Georgia', serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            color: var(--text-color);
            transition: background 0.5s ease;
        }

        .container { 
            text-align: center; 
            max-width: 450px; 
            padding: 40px; 
            background: white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.03);
            border-radius: 2px;
        }

        .logo { 
            font-size: 2.5rem; 
            letter-spacing: 6px; 
            margin-bottom: 15px; 
            font-weight: 300; 
            text-transform: uppercase;
        }

        #tagline {
            font-style: italic;
            margin-bottom: 30px;
            color: #7F8C8D;
            font-size: 1.1rem;
        }

        .btn-pay { 
            background: var(--accent-color); 
            color: white; 
            border: none; 
            padding: 20px 50px; 
            border-radius: 2px; 
            cursor: pointer; 
            font-size: 1.1rem; 
            transition: all 0.4s ease; 
            margin-top: 15px;
            letter-spacing: 2px;
            width: 100%;
        }

        .btn-pay:hover { 
            background: #444; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .lang-toggle { 
            position: absolute; 
            top: 30px; 
            right: 30px;
            background: none; 
            border: 1px solid #DDD; 
            padding: 8px 20px; 
            cursor: pointer; 
            font-family: 'Arial', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 1px;
            transition: 0.3s;
        }

        .lang-toggle:hover {
            border-color: var(--accent-color);
            background: #f8f8f8;
        }

        .admin-login {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #EEE;
        }

        .admin-login input {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid #DDD;
            box-sizing: border-box;
            border-radius: 2px;
        }

        .btn-admin {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px;
            width: 100%;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-admin:hover { background: #7f8c8d; }

        .footer-note {
            margin-top: 20px;
            font-size: 0.7rem;
            color: #BDC3C7;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <button class="lang-toggle" onclick="toggleLang()" id="lang-btn">ESPAÑOL</button>

    <div class="container">
        <div class="logo">KaMiZen</div>
        <p id="tagline">The path to internal wealth starts here.</p>

        {% if role == 'admin' %}
            <button class="btn-pay" onclick="window.location.href='/servicio'" id="admin-entry">ENTRAR GRATIS (ADMIN)</button>
        {% else %}
            <button class="btn-pay" onclick="startPayment()" id="pay-btn">ENTER THE PATH - $4.99</button>
        {% endif %}

        <div class="admin-login">
            <form action="/login" method="POST">
                <input type="text" name="username" id="user-label" placeholder="Username" required>
                <input type="password" name="password" id="pass-label" placeholder="Password" required>
                <button type="submit" class="btn-admin" id="login-btn">Admin Login</button>
            </form>
        </div>

        <div class="footer-note">KaMiZen by MAY ROGA LLC &copy; 2026</div>
    </div>

    <script>
        let currentLang = 'en';

        const content = {
            en: {
                tagline: "The path to internal wealth starts here.",
                payBtn: "ENTER THE PATH - $4.99",
                langBtn: "ESPAÑOL",
                userPl: "Username",
                passPl: "Password",
                loginBtn: "Admin Login",
                adminEntry: "ENTER GRATIS (ADMIN)"
            },
            es: {
                tagline: "El camino a la riqueza interna comienza aquí.",
                payBtn: "ENTRAR AL CAMINO - $4.99",
                langBtn: "ENGLISH",
                userPl: "Usuario",
                passPl: "Contraseña",
                loginBtn: "Ingreso Admin",
                adminEntry: "ENTRAR GRATIS (ADMIN)"
            }
        };

        function toggleLang() {
            currentLang = currentLang === 'en' ? 'es' : 'en';
            const c = content[currentLang];

            document.getElementById('tagline').innerText = c.tagline;
            document.getElementById('lang-btn').innerText = c.langBtn;
            document.getElementById('user-label').placeholder = c.userPl;
            document.getElementById('pass-label').placeholder = c.passPl;
            document.getElementById('login-btn').innerText = c.loginBtn;

            const payBtn = document.getElementById('pay-btn');
            if(payBtn) payBtn.innerText = c.payBtn;
            
            const adminBtn = document.getElementById('admin-entry');
            if(adminBtn) adminBtn.innerText = c.adminEntry;

            // Guardar preferencia para la sesión
            localStorage.setItem('kmz_lang', currentLang);
        }

        async function startPayment() {
            // Aquí se conecta con el endpoint de Stripe definido en main.py
            try {
                const response = await fetch('/create-checkout-session', { method: 'POST' });
                const session = await response.json();
                const stripe = Stripe('{{ stripe_public_key }}'); // Se pasa desde Flask
                await stripe.redirectToCheckout({ sessionId: session.id });
            } catch (error) {
                console.error("Error iniciando pago:", error);
                // Fallback para desarrollo:
                window.location.href = "/pago_exitoso";
            }
        }
        
        // Cargar idioma preferido al inicio
        window.onload = () => {
            const savedLang = localStorage.getItem('kmz_lang');
            if(savedLang && savedLang !== currentLang) toggleLang();
        };
    </script>
</body>
</html>
