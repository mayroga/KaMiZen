<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000; font-family: 'Georgia', serif; }
        #mapa-fondo { position: absolute; width: 100%; height: 100vh; background-size: cover; background-position: center; transition: 5s ease-in-out; filter: brightness(0.6); }
        #caminante { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 80px; z-index: 10; filter: drop-shadow(0 0 20px gold); }
        #narrativa-container { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.85); color: #FFF; padding: 30px; text-align: center; border-top: 2px solid #D4AF37; }
        .botones-area { margin-top: 15px; display: none; gap: 10px; justify-content: center; }
        .btn-opcion { background: none; border: 1px solid #D4AF37; color: white; padding: 10px 20px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="mapa-fondo"></div>
    <div id="caminante">üö∂‚Äç‚ôÇÔ∏è</div>
    <div id="narrativa-container">
        <div id="texto-display">Iniciando...</div>
        <div id="botones-interaccion" class="botones-area"></div>
    </div>
    <audio id="audio-player"></audio>

    <script>
        async function ciclo() {
            const res = await fetch('/api/get_sequence');
            const data = await res.json();
            
            // Actualizar Paisaje
            document.getElementById('mapa-fondo').style.backgroundImage = `url(${data.bg})`;
            document.getElementById('texto-display').innerText = data.texto;
            
            const player = document.getElementById('audio-player');
            player.src = `/api/get_audio?text=${encodeURIComponent(data.texto)}`;
            player.play();

            const btns = document.getElementById('botones-interaccion');
            if (data.opciones) {
                btns.style.display = 'flex';
                btns.innerHTML = '';
                data.opciones.forEach(o => {
                    const b = document.createElement('button');
                    b.className = 'btn-opcion';
                    b.innerText = o;
                    b.onclick = () => { btns.style.display='none'; ciclo(); };
                    btns.appendChild(b);
                });
            }

            player.onended = () => {
                if (data.finalizado) window.location.href = '/logout';
                else if (!data.opciones) setTimeout(ciclo, 6000);
            };
        }
        window.onload = ciclo;
    </script>
</body>
</html>
