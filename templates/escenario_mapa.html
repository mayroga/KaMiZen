<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KaMiZen - Camino Vivo</title>
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#FAF9F6; font-family:'Georgia', serif; }
        #mapa { width:100%; height:100vh; background:#EEE; position:relative; }
        #narrativa { 
            position:absolute; bottom:0; width:100%; background:rgba(255,255,255,0.95); 
            padding:30px; box-sizing:border-box; border-top:2px solid #1a1a1a; z-index:100;
        }
        #caminante { position:absolute; font-size:50px; transition: 3s linear; z-index:50; }
        .texto { font-size:1.3rem; color:#1a1a1a; max-width:800px; margin:0 auto; text-align:center; }
    </script>
</head>
<body>
    <div id="mapa">
        <div id="caminante">üö∂‚Äç‚ôÇÔ∏è</div>
        <div id="narrativa">
            <div id="texto-guia" class="texto">Conectando con KaMiZen...</div>
        </div>
    </div>
    <audio id="audio-player"></audio>

    <script>
        const guia = document.getElementById('texto-guia');
        const caminante = document.getElementById('caminante');
        const player = document.getElementById('audio-player');

        async function cicloCamino() {
            try {
                const res = await fetch('/api/get_sequence?lang=es');
                const data = await res.json();

                guia.innerText = data.texto;
                
                // Mover caminante
                caminante.style.left = Math.random() * 80 + 5 + '%';
                caminante.style.top = Math.random() * 60 + 5 + '%';

                // Voz Onyx
                player.src = `/api/get_audio?text=${encodeURIComponent(data.texto)}`;
                player.play();

                player.onended = () => {
                    if (data.finalizado) {
                        window.location.href = '/bienestar_final';
                    } else {
                        setTimeout(cicloCamino, 10000); // Pausa de 10s entre mensajes
                    }
                };
            } catch (e) {
                console.log("Reintentando conexi√≥n...");
                setTimeout(cicloCamino, 3000);
            }
        }

        window.onload = () => {
            cicloCamino();
        };
    </script>
</body>
</html>
