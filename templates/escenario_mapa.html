<!DOCTYPE html>
<html lang="{{lang}}">
<head>
<meta charset="UTF-8">
<style>
html,body{
margin:0;height:100%;overflow:hidden;
background:black;color:white;font-family:Georgia;
}
#bg{
position:absolute;width:110%;height:110%;
background-size:cover;
background-position:center;
transition:transform 10s ease, filter 5s ease;
filter:brightness(.65);
}
#walker{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
font-size:80px;z-index:2;
}
#panel{
position:absolute;bottom:0;width:100%;
background:rgba(0,0,0,.85);
padding:20px;text-align:center;
}
button{
background:none;border:1px solid gold;
color:white;padding:10px 20px;margin:5px;
}
</style>
</head>
<body>

<div id="bg"></div>
<div id="walker">üö∂‚Äç‚ôÇÔ∏è</div>

<div id="panel">
<div id="text"></div>
<div id="choices"></div>
</div>

<audio id="audio"></audio>

<script>
async function cycle(){
 const r=await fetch("/api/state");
 const d=await r.json();

 const bg=document.getElementById("bg");
 bg.style.backgroundImage=`url(${d.bg})`;
 bg.style.transform="scale(1.15)";

 document.getElementById("text").innerText=d.text;

 if(d.voz && d.text){
  const a=document.getElementById("audio");
  a.src="/api/audio?text="+encodeURIComponent(d.text);
  a.play();
 }

 const ch=document.getElementById("choices");
 ch.innerHTML="";
 if(d.opciones){
  d.opciones.forEach(o=>{
   const b=document.createElement("button");
   b.innerText=o.texto;
   b.onclick=()=>ch.innerHTML="";
   ch.appendChild(b);
  });
 }

 if(!d.final) setTimeout(cycle,6000);
 else setTimeout(()=>location.href="/logout",4000);
}

cycle();
</script>
</body>
</html>
